<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡å™¨å»¶è¿Ÿæ£€æµ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-dark': '#121212',
                        'card-dark': '#1e1e1e',
                        'accent-orange': '#ff8c42',
                        'success-green': '#2a9d8f',
                        'error-red': '#e76f51',
                        'offline-gray': '#6c757d'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'bounce-gentle': 'bounceGentle 0.8s ease-in-out',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scale-hover': 'scaleHover 0.2s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        bounceGentle: {
                            '0%, 20%, 50%, 80%, 100%': { transform: 'translateY(0)' },
                            '40%': { transform: 'translateY(-5px)' },
                            '60%': { transform: 'translateY(-3px)' }
                        },
                        scaleHover: {
                            '0%': { transform: 'scale(1)' },
                            '100%': { transform: 'scale(1.02)' }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="m-0 p-0 font-sans bg-bg-dark text-gray-200 min-h-screen flex justify-center items-center">
    <div class="max-w-2xl w-full mx-4">
        <!-- è®¸å¯åè®®é¡µé¢ -->
        <div class="bg-card-dark rounded-2xl p-8 shadow-2xl border border-accent-orange/20 animate-fade-in" id="license-card">
            <h1 class="text-3xl font-semibold text-accent-orange mb-6 text-center animate-bounce-gentle">
                è½¯ä»¶ä½¿ç”¨è®¸å¯åè®®
            </h1>
            
            <div class="max-h-80 overflow-y-auto p-4 bg-black/20 rounded-lg mb-6 text-left border border-accent-orange/20 animate-slide-up">
                <h3 class="text-accent-orange text-lg font-medium mt-0 border-b border-accent-orange/30 pb-2 mb-4">
                    ğŸ“Œ æ‚¨å¯ä»¥è‡ªç”±ï¼š
                </h3>
                <ul class="pl-6 space-y-2">
                    <li class="text-success-green transition-colors duration-300 hover:text-green-400">
                        âœ… ä½¿ç”¨ã€å¤åˆ¶ã€ä¿®æ”¹æœ¬è½¯ä»¶ï¼ˆåŒ…æ‹¬åç¼–è¯‘ã€äºŒæ¬¡å¼€å‘ï¼‰
                    </li>
                    <li class="text-success-green transition-colors duration-300 hover:text-green-400">
                        âœ… éå•†ä¸šæ€§åœ°åˆ†äº«æœ¬è½¯ä»¶ï¼ˆç¦æ­¢æ”¶è´¹æˆ–æ†ç»‘å•†ä¸šæœåŠ¡ï¼‰
                    </li>
                </ul>
                
                <h3 class="text-accent-orange text-lg font-medium mt-6 border-b border-accent-orange/30 pb-2 mb-4">
                    ğŸš« æ‚¨å¿…é¡»éµå®ˆä»¥ä¸‹é™åˆ¶ï¼š
                </h3>
                <ol class="pl-6 space-y-3">
                    <li class="text-error-red">
                        <strong>ç¦æ­¢å•†ç”¨</strong><br>
                        <span class="text-sm">âœ— ä¸å¾—ç”¨äºä»»ä½•ç›ˆåˆ©ã€å•†ä¸šæˆ–ä¼ä¸šç”¨é€”ï¼ˆéœ€æˆæƒè¯·å•ç‹¬è”ç³»ï¼‰</span>
                    </li>
                    <li class="text-error-red">
                        <strong>ç¦æ­¢è¿æ³•åŠæ»¥ç”¨è¡Œä¸º</strong><br>
                        <span class="text-sm">
                            âœ— <strong>ç¦æ­¢ç›‘å¬ã€ç›‘æ§ä»–äººæ•°æ®</strong>ï¼ˆå¦‚çªƒå–éšç§ã€éæ³•æŠ“å–é€šä¿¡å†…å®¹ï¼‰<br>
                            âœ— <strong>ç¦æ­¢æ¶æ„çˆ¬è™«</strong>ï¼ˆå¦‚å¤§è§„æ¨¡çˆ¬å–å—ä¿æŠ¤æ•°æ®ã€å¹²æ‰°ç½‘ç«™è¿è¡Œï¼‰<br>
                            âœ— <strong>ç¦æ­¢æŸå®³ä»–äººè®¾å¤‡æˆ–ç½‘ç»œå®‰å…¨</strong>ï¼ˆå¦‚ä¼ æ’­ç—…æ¯’ã€DDoSæ”»å‡»ï¼‰
                        </span>
                    </li>
                    <li class="text-error-red">
                        <strong>ç¦æ­¢ä¼ æ’­è¿è§„å†…å®¹</strong><br>
                        <span class="text-sm">
                            âœ— æ¶‰æ”¿ã€æ¶‰é»„ã€æš´åŠ›ã€ææ€–ç­‰è¿æ³•ä¿¡æ¯<br>
                            âœ— ä¾µçŠ¯éšç§ã€è¯½è°¤ä»–äººç­‰ä¸è‰¯å†…å®¹<br>
                            âœ— <strong>ç¦æ­¢ä¸Šä¼ æˆ–ä¼ æ’­ä¸è½¯ä»¶åŠŸèƒ½æ— å…³çš„å†…å®¹</strong>
                        </span>
                    </li>
                </ol>
                
                <h3 class="text-accent-orange text-lg font-medium mt-6 border-b border-accent-orange/30 pb-2 mb-4">
                    âš ï¸ å…è´£å£°æ˜
                </h3>
                <ul class="pl-6 space-y-2">
                    <li class="text-gray-300">æœ¬è½¯ä»¶æŒ‰ <strong>"åŸæ ·"</strong> æä¾›ï¼Œå¼€å‘è€… <strong>ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»</strong></li>
                    <li class="text-gray-300">ç”¨æˆ·éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨é£é™©ï¼Œè¿è§„è¡Œä¸ºä¸å¼€å‘è€…æ— å…³</li>
                </ul>
                
                <h3 class="text-accent-orange text-lg font-medium mt-6 border-b border-accent-orange/30 pb-2 mb-4">
                    âš–ï¸ è¿è§„åæœ
                </h3>
                <ul class="pl-6 space-y-2">
                    <li class="text-error-red">ç«‹å³ç»ˆæ­¢ä½¿ç”¨æƒ</li>
                    <li class="text-error-red">ä¿ç•™æ³•å¾‹è¿½è´£æƒåˆ©</li>
                </ul>
                
                <h3 class="text-accent-orange text-lg font-medium mt-6 border-b border-accent-orange/30 pb-2 mb-4">
                    ğŸª Cookieä½¿ç”¨è¯´æ˜
                </h3>
                <div class="pl-6 space-y-2 text-sm text-gray-300">
                    <p>ä¸ºäº†æä¾›æ›´å¥½çš„æœåŠ¡ä½“éªŒï¼Œæœ¬åº”ç”¨å°†åœ¨æ‚¨åŒæ„åè®¾ç½®ä»¥ä¸‹Cookieï¼š</p>
                    <ul class="list-disc pl-4 space-y-1">
                        <li><strong>è®¸å¯åŒæ„çŠ¶æ€</strong> - è®°å½•æ‚¨å·²åŒæ„æœ¬åè®®ï¼Œé¿å…é‡å¤æ˜¾ç¤º</li>
                        <li><strong>ç”¨æˆ·è®¾ç½®</strong> - ä¿å­˜æ‚¨çš„ä¸ªæ€§åŒ–è®¾ç½®å’Œåå¥½</li>
                        <li><strong>ä¼šè¯ä¿¡æ¯</strong> - ç»´æŠ¤æ‚¨çš„ç™»å½•çŠ¶æ€å’Œæ“ä½œè®°å½•</li>
                        <li><strong>åŠŸèƒ½æ€§Cookie</strong> - ç¡®ä¿åº”ç”¨æ­£å¸¸è¿è¡Œæ‰€éœ€çš„æŠ€æœ¯æ•°æ®</li>
                    </ul>
                    <p class="text-xs text-gray-400 mt-2">
                        è¿™äº›Cookieä»…ç”¨äºæ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œä¸ä¼šæ”¶é›†ä¸ªäººæ•æ„Ÿä¿¡æ¯ã€‚æ‚¨å¯ä»¥éšæ—¶é€šè¿‡æµè§ˆå™¨è®¾ç½®æ¸…é™¤è¿™äº›Cookieã€‚
                    </p>
                </div>
            </div>
            
            <div class="flex items-center justify-center mb-6 animate-slide-up" style="animation-delay: 0.2s;">
                <input type="checkbox" id="agree-checkbox" class="w-5 h-5 mr-2 accent-accent-orange transition-transform duration-200 hover:scale-110">
                <label for="agree-checkbox" class="text-gray-300 cursor-pointer hover:text-white transition-colors duration-300">
                    æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä¸Šè¿°è®¸å¯åè®®åŠCookieä½¿ç”¨æ”¿ç­–
                </label>
            </div>
            
            <button id="agree-btn" class="w-full bg-accent-orange text-white border-0 py-3 px-6 rounded-full text-lg font-medium cursor-pointer transition-all duration-300 disabled:bg-gray-700 disabled:cursor-not-allowed disabled:text-gray-500 enabled:hover:bg-orange-500 enabled:hover:scale-105 enabled:hover:shadow-lg enabled:hover:shadow-accent-orange/30 animate-slide-up" style="animation-delay: 0.4s;" disabled>
                åŒæ„å¹¶ç»§ç»­
            </button>
        </div>
        
        <!-- æ£€æµ‹é¡µé¢ -->
        <div class="bg-card-dark rounded-2xl p-8 shadow-2xl border border-accent-orange/20 hidden animate-fade-in" id="detection-card">
            <h1 class="text-3xl font-semibold text-accent-orange mb-6 text-center animate-bounce-gentle">
                æœåŠ¡å™¨å»¶è¿Ÿæ£€æµ‹
            </h1>
            
            <!-- CookieçŠ¶æ€æ˜¾ç¤º -->
            <div class="bg-success-green/10 rounded-lg p-4 mb-6 border border-success-green/20 animate-fade-in">
                <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" class="text-success-green mr-2">
                        <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1h-11zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2h-7zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48V8.35zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.35z"/>
                    </svg>
                    <span class="text-success-green font-medium">Cookieå·²æˆåŠŸè®¾ç½®</span>
                </div>
                <div class="text-sm text-gray-300 mt-2" id="cookie-info">
                    å·²è®¾ç½® <span id="cookie-count">0</span> ä¸ªCookieï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
                </div>
                <button id="show-cookies-btn" class="mt-2 text-accent-orange hover:text-orange-400 transition-colors text-sm underline">
                    æŸ¥çœ‹å½“å‰Cookie
                </button>
            </div>
            
            <!-- Cookieè¯¦æƒ…æ¨¡æ€æ¡† -->
            <div id="cookie-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
                <div class="bg-card-dark rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto border border-accent-orange/20">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-accent-orange">å½“å‰Cookieä¿¡æ¯</h3>
                        <button id="close-modal-btn" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
                    </div>
                    <div id="cookie-list" class="space-y-3">
                        <!-- Cookieåˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                    <div class="mt-4 pt-4 border-t border-accent-orange/20">
                        <button id="clear-cookies-btn" class="bg-error-red text-white px-4 py-2 rounded font-medium hover:bg-red-600 transition-colors">
                            æ¸…é™¤æ‰€æœ‰Cookie
                        </button>
                    </div>
                </div>
            </div>
            
            <p id="status-message" class="text-center mb-6 text-gray-300 animate-pulse-slow">
                æ­£åœ¨æµ‹è¯•æœåŠ¡å™¨è¿æ¥è´¨é‡ï¼Œè¯·ç¨å€™...
            </p>
            
            <div class="flex flex-col gap-4 mb-6">
                <div class="server-item flex justify-between items-center p-4 bg-accent-orange/10 rounded-lg border border-accent-orange/20 transition-all duration-300 hover:border-success-green hover:bg-success-green/10 hover:scale-102 cursor-pointer animate-slide-up" id="cn-server" data-server="cn">
                    <div class="text-left">
                        <div class="font-medium mb-1">ä¸­å›½æœåŠ¡å™¨</div>
                        <div class="text-sm text-gray-400" id="cn-ip">cn.tangbot.xyz:3000</div>
                    </div>
                    <div class="font-semibold min-w-16 text-center" id="cn-ping">
                        <span class="inline-block w-4 h-4 border-2 border-accent-orange/30 border-t-accent-orange rounded-full animate-spin"></span>
                    </div>
                </div>
                
                <div class="server-item flex justify-between items-center p-4 bg-accent-orange/10 rounded-lg border border-accent-orange/20 transition-all duration-300 hover:border-success-green hover:bg-success-green/10 hover:scale-102 cursor-pointer animate-slide-up" id="us-server" data-server="us" style="animation-delay: 0.1s;">
                    <div class="text-left">
                        <div class="font-medium mb-1">ç¾å›½æœåŠ¡å™¨</div>
                        <div class="text-sm text-gray-400" id="us-ip">us.tangbot.xyz:3000</div>
                    </div>
                    <div class="font-semibold min-w-16 text-center" id="us-ping">
                        <span class="inline-block w-4 h-4 border-2 border-accent-orange/30 border-t-accent-orange rounded-full animate-spin"></span>
                    </div>
                </div>
            </div>
            
            <div id="offline-message" class="text-error-red text-center mt-4 font-medium hidden animate-fade-in">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="inline mr-2">
                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                </svg>
                ç½‘ç»œè¿æ¥ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè®¾ç½®
            </div>
            
            <button id="connect-btn" class="w-full bg-accent-orange text-white border-0 py-3 px-6 rounded-full text-lg font-medium cursor-pointer transition-all duration-300 disabled:bg-gray-700 disabled:cursor-not-allowed disabled:text-gray-500 enabled:hover:bg-orange-500 enabled:hover:scale-105 enabled:hover:shadow-lg enabled:hover:shadow-accent-orange/30 animate-slide-up mb-4" style="animation-delay: 0.3s;" disabled>
                è¿æ¥æœ€ä½³æœåŠ¡å™¨
            </button>
            <button id="retry-btn" class="w-full bg-gray-600 text-white border-0 py-3 px-6 rounded-full text-lg font-medium cursor-pointer transition-all duration-300 hover:bg-gray-500 hover:scale-105 hidden animate-fade-in">
                é‡è¯•æ£€æµ‹
            </button>
            <div id="status-text" class="text-sm text-gray-400 text-center mt-4 animate-pulse">
                æ­£åœ¨æ£€æµ‹æœ€ä¼˜æœåŠ¡å™¨...
            </div>
        </div>
    </div>

    <script>
        // Cookieç®¡ç†åŠŸèƒ½
        class CookieManager {
            // è®¾ç½®Cookie
            static setCookie(name, value, days = 365, options = {}) {
                const defaults = {
                    path: '/',
                    secure: location.protocol === 'https:',
                    sameSite: 'Lax'
                };
                
                const settings = { ...defaults, ...options };
                
                let cookieString = `${name}=${encodeURIComponent(value)}`;
                
                if (days) {
                    const date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    cookieString += `; expires=${date.toUTCString()}`;
                }
                
                if (settings.path) cookieString += `; path=${settings.path}`;
                if (settings.domain) cookieString += `; domain=${settings.domain}`;
                if (settings.secure) cookieString += `; secure`;
                if (settings.sameSite) cookieString += `; SameSite=${settings.sameSite}`;
                if (settings.httpOnly) cookieString += `; HttpOnly`;
                
                document.cookie = cookieString;
                
                console.log(`Cookieè®¾ç½®æˆåŠŸ: ${name}=${value}`);
                return true;
            }
            
            // è·å–Cookie
            static getCookie(name) {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) {
                        return decodeURIComponent(c.substring(nameEQ.length, c.length));
                    }
                }
                return null;
            }
            
            // åˆ é™¤Cookie
            static deleteCookie(name) {
                document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
                console.log(`Cookieåˆ é™¤æˆåŠŸ: ${name}`);
            }
            
            // è·å–æ‰€æœ‰Cookie
            static getAllCookies() {
                const cookies = {};
                if (document.cookie) {
                    document.cookie.split(';').forEach(cookie => {
                        const [name, value] = cookie.trim().split('=');
                        if (name && value) {
                            cookies[name] = decodeURIComponent(value);
                        }
                    });
                }
                return cookies;
            }
            
            // æ¸…é™¤æ‰€æœ‰Cookie
            static clearAllCookies() {
                const cookies = this.getAllCookies();
                Object.keys(cookies).forEach(name => {
                    this.deleteCookie(name);
                });
                console.log('æ‰€æœ‰Cookieå·²æ¸…é™¤');
            }
            
            // è®¾ç½®åº”ç”¨ç›¸å…³çš„Cookie
            static setAppCookies() {
                const timestamp = new Date().toISOString();
                const sessionId = 'sess_' + Math.random().toString(36).substr(2, 9);
                const userId = 'user_' + Math.random().toString(36).substr(2, 8);
                
                // è®¾ç½®å„ç§ç±»å‹çš„Cookie
                const cookies = [
                    { name: 'license_agreed', value: 'true', days: 365, description: 'è®¸å¯åè®®åŒæ„çŠ¶æ€' },
                    { name: 'consent_timestamp', value: timestamp, days: 365, description: 'åŒæ„æ—¶é—´æˆ³' },
                    { name: 'session_id', value: sessionId, days: 1, description: 'ä¼šè¯ID' },
                    { name: 'user_id', value: userId, days: 365, description: 'ç”¨æˆ·æ ‡è¯†' },
                    { name: 'app_version', value: '1.0.0', days: 30, description: 'åº”ç”¨ç‰ˆæœ¬' },
                    { name: 'theme_preference', value: 'dark', days: 90, description: 'ä¸»é¢˜åå¥½' },
                    { name: 'language', value: 'zh-CN', days: 365, description: 'è¯­è¨€è®¾ç½®' },
                    { name: 'analytics_enabled', value: 'true', days: 365, description: 'åˆ†æç»Ÿè®¡å¼€å…³' }
                ];
                
                cookies.forEach(cookie => {
                    this.setCookie(cookie.name, cookie.value, cookie.days);
                });
                
                return cookies;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const licenseCard = document.getElementById('license-card');
            const detectionCard = document.getElementById('detection-card');
            const agreeCheckbox = document.getElementById('agree-checkbox');
            const agreeBtn = document.getElementById('agree-btn');
            const cookieInfo = document.getElementById('cookie-info');
            const cookieCount = document.getElementById('cookie-count');
            const showCookiesBtn = document.getElementById('show-cookies-btn');
            const cookieModal = document.getElementById('cookie-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const cookieList = document.getElementById('cookie-list');
            const clearCookiesBtn = document.getElementById('clear-cookies-btn');
            
            // åè®®åŒæ„é€»è¾‘
            agreeCheckbox.addEventListener('change', function() {
                agreeBtn.disabled = !this.checked;
                if (this.checked) {
                    agreeBtn.classList.add('animate-bounce-gentle');
                } else {
                    agreeBtn.classList.remove('animate-bounce-gentle');
                }
            });
            
            agreeBtn.addEventListener('click', function() {
                // è®¾ç½®åº”ç”¨Cookie
                const appCookies = CookieManager.setAppCookies();
                
                // å­˜å‚¨ç”¨æˆ·å·²åŒæ„çš„çŠ¶æ€åˆ°localStorageï¼ˆå¤‡ç”¨ï¼‰
                localStorage.setItem('licenseAgreed', 'true');
                
                // æ˜¾ç¤ºCookieè®¾ç½®æˆåŠŸæç¤º
                agreeBtn.textContent = 'æ­£åœ¨è®¾ç½®Cookie...';
                agreeBtn.disabled = true;
                
                setTimeout(() => {
                    // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
                    licenseCard.style.animation = 'fadeOut 0.5s ease-in-out';
                    setTimeout(() => {
                        licenseCard.classList.add('hidden');
                        detectionCard.classList.remove('hidden');
                        updateCookieInfo();
                        initDetection();
                    }, 500);
                }, 1000);
            });
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»åŒæ„è¿‡åè®®
            if (CookieManager.getCookie('license_agreed') === 'true' || localStorage.getItem('licenseAgreed') === 'true') {
                licenseCard.classList.add('hidden');
                detectionCard.classList.remove('hidden');
                updateCookieInfo();
                initDetection();
            }
            
            // æ›´æ–°Cookieä¿¡æ¯æ˜¾ç¤º
            function updateCookieInfo() {
                const cookies = CookieManager.getAllCookies();
                const count = Object.keys(cookies).length;
                cookieCount.textContent = count;
            }
            
            // æ˜¾ç¤ºCookieè¯¦æƒ…
            function showCookieDetails() {
                const cookies = CookieManager.getAllCookies();
                const appCookieDescriptions = {
                    'license_agreed': 'è®¸å¯åè®®åŒæ„çŠ¶æ€',
                    'consent_timestamp': 'åŒæ„æ—¶é—´æˆ³',
                    'session_id': 'ä¼šè¯ID',
                    'user_id': 'ç”¨æˆ·æ ‡è¯†',
                    'app_version': 'åº”ç”¨ç‰ˆæœ¬',
                    'theme_preference': 'ä¸»é¢˜åå¥½',
                    'language': 'è¯­è¨€è®¾ç½®',
                    'analytics_enabled': 'åˆ†æç»Ÿè®¡å¼€å…³'
                };
                
                cookieList.innerHTML = '';
                
                if (Object.keys(cookies).length === 0) {
                    cookieList.innerHTML = '<p class="text-gray-400 text-center">æš‚æ— Cookie</p>';
                    return;
                }
                
                Object.entries(cookies).forEach(([name, value]) => {
                    const description = appCookieDescriptions[name] || 'ç¬¬ä¸‰æ–¹Cookie';
                    const isAppCookie = appCookieDescriptions.hasOwnProperty(name);
                    
                    const cookieElement = document.createElement('div');
                    cookieElement.className = `p-3 rounded-lg border ${isAppCookie ? 'bg-accent-orange/10 border-accent-orange/20' : 'bg-gray-700/30 border-gray-600'}`;
                    cookieElement.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <div class="font-medium text-accent-orange">${name}</div>
                                <div class="text-sm text-gray-400">${description}</div>
                            </div>
                            <span class="text-xs px-2 py-1 rounded ${isAppCookie ? 'bg-success-green text-white' : 'bg-gray-600 text-gray-300'}">
                                ${isAppCookie ? 'åº”ç”¨' : 'ç¬¬ä¸‰æ–¹'}
                            </span>
                        </div>
                        <div class="text-sm text-gray-300 break-all">
                            å€¼: ${value.length > 50 ? value.substring(0, 50) + '...' : value}
                        </div>
                    `;
                    cookieList.appendChild(cookieElement);
                });
            }
            
            // Cookieç›¸å…³äº‹ä»¶ç›‘å¬
            showCookiesBtn.addEventListener('click', function() {
                showCookieDetails();
                cookieModal.classList.remove('hidden');
                cookieModal.classList.add('flex');
            });
            
            closeModalBtn.addEventListener('click', function() {
                cookieModal.classList.add('hidden');
                cookieModal.classList.remove('flex');
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            cookieModal.addEventListener('click', function(e) {
                if (e.target === cookieModal) {
                    cookieModal.classList.add('hidden');
                    cookieModal.classList.remove('flex');
                }
            });
            
            clearCookiesBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰Cookieå—ï¼Ÿè¿™å°†éœ€è¦é‡æ–°åŒæ„åè®®ã€‚')) {
                    CookieManager.clearAllCookies();
                    localStorage.removeItem('licenseAgreed');
                    location.reload();
                }
            });
            
            // å®šæœŸæ›´æ–°Cookieä¿¡æ¯
            setInterval(updateCookieInfo, 5000);
            
            // åˆå§‹åŒ–æ£€æµ‹é€»è¾‘ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰
            function initDetection() {
                const cnServer = document.getElementById('cn-server');
                const usServer = document.getElementById('us-server');
                const cnIp = document.getElementById('cn-ip');
                const usIp = document.getElementById('us-ip');
                const cnPing = document.getElementById('cn-ping');
                const usPing = document.getElementById('us-ping');
                const connectBtn = document.getElementById('connect-btn');
                const retryBtn = document.getElementById('retry-btn');
                const statusText = document.getElementById('status-text');
                const statusMessage = document.getElementById('status-message');
                const offlineMessage = document.getElementById('offline-message');
                
                // æœåŠ¡å™¨é…ç½®
                const SERVERS = {
                    cn: {
                        display: 'cn.tangbot.xyz:3000',
                        actual: '110.42.70.166:3000',
                        name: 'ä¸­å›½æœåŠ¡å™¨'
                    },
                    us: {
                        display: 'us.tangbot.xyz:3000',
                        actual: 'us.tangbot.xyz:3000',
                        name: 'ç¾å›½æœåŠ¡å™¨'
                    }
                };
                
                let bestServer = null;
                let isOnline = true;
                
                // æ·»åŠ é€‰ä¸­çŠ¶æ€çš„æ ·å¼ç±»
                function selectServer(serverElement) {
                    cnServer.classList.remove('border-success-green', 'bg-success-green/20');
                    usServer.classList.remove('border-success-green', 'bg-success-green/20');
                    serverElement.classList.add('border-success-green', 'bg-success-green/20');
                    serverElement.style.animation = 'bounceGentle 0.8s ease-in-out';
                }
                
                // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
                function checkNetworkStatus() {
                    isOnline = navigator.onLine;
                    if (!isOnline) {
                        showOfflineStatus();
                    }
                    return isOnline;
                }
                
                // æ˜¾ç¤ºç¦»çº¿çŠ¶æ€
                function showOfflineStatus() {
                    offlineMessage.classList.remove('hidden');
                    statusMessage.textContent = 'æ— æ³•è¿æ¥åˆ°äº’è”ç½‘';
                    statusText.textContent = 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•';
                    connectBtn.classList.add('hidden');
                    retryBtn.classList.remove('hidden');
                    cnPing.innerHTML = '<span class="text-error-red">ç¦»çº¿</span>';
                    usPing.innerHTML = '<span class="text-error-red">ç¦»çº¿</span>';
                }
                
                // æµ‹é‡æœåŠ¡å™¨å»¶è¿Ÿ
                async function measureServerLatency(server) {
                    const startTime = performance.now();
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 3000);
                        
                        const testUrl = `http://${server.actual}/miya/miya.html?ping_test=${Date.now()}`;
                        const response = await fetch(testUrl, {
                            method: 'HEAD',
                            mode: 'no-cors',
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId);
                        const latency = Math.round(performance.now() - startTime);
                        return latency;
                    } catch (error) {
                        console.error(`æµ‹é‡ ${server.name} å»¶è¿Ÿå¤±è´¥:`, error);
                        return Infinity;
                    }
                }
                
                // æ›´æ–°æœåŠ¡å™¨çŠ¶æ€æ˜¾ç¤º
                function updateServerDisplay(serverKey, latency) {
                    const serverElement = serverKey === 'cn' ? cnPing : usPing;
                    const serverItem = serverKey === 'cn' ? cnServer : usServer;
                    
                    if (latency === Infinity) {
                        serverElement.innerHTML = '<span class="text-error-red">è¶…æ—¶</span>';
                        return;
                    }
                    
                    serverElement.style.animation = 'fadeIn 0.5s ease-in-out';
                    
                    if (latency < 200) {
                        serverElement.innerHTML = `<span class="text-success-green">${latency}ms</span>`;
                    } else if (latency < 500) {
                        serverElement.innerHTML = `<span class="text-accent-orange">${latency}ms</span>`;
                    } else {
                        serverElement.innerHTML = `<span class="text-error-red">${latency}ms</span>`;
                    }
                }
                
                // æ£€æµ‹æ‰€æœ‰æœåŠ¡å™¨
                async function detectAllServers() {
                    if (!checkNetworkStatus()) return;
                    
                    // è®°å½•æœåŠ¡å™¨æ£€æµ‹æ´»åŠ¨åˆ°Cookie
                    CookieManager.setCookie('last_server_check', new Date().toISOString(), 1);
                    
                    offlineMessage.classList.add('hidden');
                    connectBtn.disabled = true;
                    retryBtn.classList.add('hidden');
                    connectBtn.classList.remove('hidden');
                    statusMessage.textContent = 'æ­£åœ¨æµ‹è¯•æœåŠ¡å™¨è¿æ¥è´¨é‡ï¼Œè¯·ç¨å€™...';
                    statusText.textContent = 'æ­£åœ¨æ£€æµ‹æœ€ä¼˜æœåŠ¡å™¨...';
                    
                    cnPing.innerHTML = '<span class="inline-block w-4 h-4 border-2 border-accent-orange/30 border-t-accent-orange rounded-full animate-spin"></span>';
                    usPing.innerHTML = '<span class="inline-block w-4 h-4 border-2 border-accent-orange/30 border-t-accent-orange rounded-full animate-spin"></span>';
                    cnServer.classList.remove('border-success-green', 'bg-success-green/20');
                    usServer.classList.remove('border-success-green', 'bg-success-green/20');
                    bestServer = null;
                    
                    try {
                        const [cnLatency, usLatency] = await Promise.all([
                            measureServerLatency(SERVERS.cn),
                            measureServerLatency(SERVERS.us)
                        ]);
                        
                        updateServerDisplay('cn', cnLatency);
                        updateServerDisplay('us', usLatency);
                        
                        if (cnLatency < usLatency) {
                            bestServer = SERVERS.cn;
                            statusText.textContent = `${SERVERS.cn.name}å»¶è¿Ÿæ›´ä½ï¼Œæ¨èè¿æ¥`;
                            selectServer(cnServer);
                            CookieManager.setCookie('preferred_server', 'cn', 7);
                        } else if (usLatency < cnLatency) {
                            bestServer = SERVERS.us;
                            statusText.textContent = `${SERVERS.us.name}å»¶è¿Ÿæ›´ä½ï¼Œæ¨èè¿æ¥`;
                            selectServer(usServer);
                            CookieManager.setCookie('preferred_server', 'us', 7);
                        } else {
                            bestServer = SERVERS.cn;
                            statusText.textContent = 'å·²é€‰æ‹©é»˜è®¤æœåŠ¡å™¨';
                            selectServer(cnServer);
                            CookieManager.setCookie('preferred_server', 'cn', 7);
                        }
                        
                        connectBtn.disabled = false;
                        connectBtn.classList.add('animate-bounce-gentle');
                        
                    } catch (error) {
                        console.error('æ£€æµ‹æœåŠ¡å™¨æ—¶å‡ºé”™:', error);
                        statusText.textContent = 'æœåŠ¡å™¨æ£€æµ‹å¤±è´¥ï¼Œè¯·é‡è¯•';
                        retryBtn.classList.remove('hidden');
                        connectBtn.classList.add('hidden');
                    }
                }
                
                // æœåŠ¡å™¨é€‰æ‹©ç‚¹å‡»äº‹ä»¶
                cnServer.addEventListener('click', function() {
                    if (bestServer) {
                        bestServer = SERVERS.cn;
                        selectServer(cnServer);
                        statusText.textContent = `å·²é€‰æ‹© ${SERVERS.cn.name}`;
                        CookieManager.setCookie('selected_server', 'cn', 7);
                    }
                });
                
                usServer.addEventListener('click', function() {
                    if (bestServer) {
                        bestServer = SERVERS.us;
                        selectServer(usServer);
                        statusText.textContent = `å·²é€‰æ‹© ${SERVERS.us.name}`;
                        CookieManager.setCookie('selected_server', 'us', 7);
                    }
                });
                
                // è¿æ¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                connectBtn.addEventListener('click', function() {
                    if (bestServer) {
                        statusText.textContent = `æ­£åœ¨è¿æ¥åˆ° ${bestServer.name}...`;
                        CookieManager.setCookie('connection_attempt', new Date().toISOString(), 1);
                        
                        const targetUrl = bestServer === SERVERS.cn ? 
                            `http://${bestServer.actual}/miya/miya.html` : 
                            `http://${bestServer.actual}/miya/miya.html`;
                        window.location.href = targetUrl;
                    }
                });
                
                // é‡è¯•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                retryBtn.addEventListener('click', detectAllServers);
                
                // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
                window.addEventListener('online', () => {
                    statusText.textContent = 'ç½‘ç»œå·²æ¢å¤ï¼Œé‡æ–°æ£€æµ‹ä¸­...';
                    detectAllServers();
                });
                
                window.addEventListener('offline', showOfflineStatus);
                
                // å¼€å§‹æ£€æµ‹
                detectAllServers();
            }
        });
        
        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                0% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>